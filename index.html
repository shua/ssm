<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link type="text/css" rel="stylesheet" href="style.css"/>
<script src="cmdline.js"></script>
<script src="stream.js"></script>
<script>
function addstream(div) {
	ct = document.getElementsByClassName("container")[0]
	ct.appendChild(div)
	if(strs.length !== 0) strs[cur].id=""
	cur = strs.push(div) - 1
	div.id="cur"
	setcurmaster()
}

window.onload = function() {
	initcmdline()
	inityt()
}
function handleKeyKEY(k) {
	console.log(k)
	switch (k) {
	case ":":
		cmdline.focus()
		break
	case "j":
		focusnext(1)
		break
	case "k":
		focusnext(-1)
		break
	case "t":
		togglelayout()
		break
	case "m":
		mute()
		break
	case "M":
		strs[cur].mute()
		break
	case "p":
		play()
		break
	case " ":
		setcurmaster()
		break
	}
}
cmds = {
	"open": function(args) {
		console.log("open ",args)
	},
	"youtube": function(args) {
		console.log("yt", args)
		addyt(args[0])
	},
	"birds": function(args) {
		morebirds()
	}
}
cmds["yt"] = cmds["youtube"]
var cur = 0
var strs = new Array();
var num_master = 1
function focusnext(dir) {
	if (strs.length === 0) return
	strs[cur].id = ""
	cur += dir;
	if (cur < 0) cur = strs.length - 1
	if (cur >= strs.length) cur = 0
	strs[cur].id = "cur"
}
function setcurmaster() {
	if(strs[cur].className.indexOf("master") === -1) {
		pm = strs[num_master-1]
		pm.className = pm.className.replace(/(?:^|\s)master(?!\S)/g, '')
		pm.mute(true)
		strs[cur].className += " master"
	}
	i = strs[cur]
	strs.splice(cur, 1)
	strs.unshift(i)
	i.mute(false)
	cur = 0
	reorder()
}
function reorder() {
	for(let i=0; i<strs.length; i++) {
		strs[i].style.order=i
	}
}
function togglelayout() {
	b = document.body
	f = h = "horz"
	t = v = "vert"
	if(b.className.indexOf(h) === -1) {
		f = v
		t = h
	}
	if(b.className.indexOf(f) === -1)
		b.className += " "+t
	else
		b.className = b.className.replace(f,t)
}
function mute() {
	for(s in strs)
		strs[s].mute(!(s < num_master && this.ismuted))
	this.ismuted = !this.ismuted
}
mute.ismuted = false
function play() {
	this.isplaying = !this.isplaying
	for(s in strs)
		strs[s].play(play.isplaying)
}
play.isplaying = true

function morebirds() {
	cmds["youtube"](["u9Sk6-LIvDc"])
	cmds["youtube"](["JfXiBkL9U5s"])
	cmds["youtube"](["qF6YkiJXfEA"])
	cmds["youtube"](["IiFSeJhHMgY"])
}
</script>
</head>
<body class="horz">
<input type="text" tabindex="-1" class="cmdline"/>
<div class="container"></div>
</body>
</html>